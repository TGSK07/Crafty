{% extends "base.html" %}
{% block title %}Cart — Crafty{% endblock %}
{% block content %}
  <h1>Your Cart</h1>

  {% if items %}
    <table>
      <thead>
        <tr><th>Product</th><th>Unit Price</th><th>Qty</th><th>Total</th><th>Action</th></tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td><a href="{{ it.product.get_absolute_url }}">{{ it.product.title }}</a></td>
            <td>₹{{ it.unit_price_inr }}</td>

            <!-- Update form: separate per item -->
            <td>
              <form method="post" action="{% url 'cart' %}" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ it.product.pk }}">
                <input type="number" name="qty" value="{{ it.quantity }}" min="1" style="width:72px;">
                <button type="submit" name="action" value="set">Update</button>
              </form>
            </td>

            <td>₹{{ it.total }}</td>

            <!-- Remove form: separate per item -->
            <td>
              <form method="post" action="{% url 'cart' %}" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ it.product.pk }}">
                <button type="submit" name="action" value="remove" onclick="return confirm('Remove this item?');">Remove</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Grand Total:</strong> ₹{{ total }}</p>
    <p><a href="{% url 'checkout' %}">Proceed to Checkout</a></p>

  {% else %}
    <p>Your cart is empty. <a href="{% url 'product_list' %}">Shop now</a></p>
  {% endif %}

{% endblock %}

{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Crafty{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
  <script defer src="{% static 'js/script.js' %}"></script>
  <script defer src="{% static 'js/theme.js' %}"></script>
  <script>
    const CraftyConfig = {
      cartUrl: "{% url 'cart' %}",
      cartCountUrl: "{% url 'cart_count' %}"
    };
  </script>
  <script defer src="{% static 'js/cart.js' %}"></script>
</head>
<body data-theme="dark">
  <header class="site-header">
      <nav class="nav">
        <div class="nav-left">
          <a class="brand" href="{% url 'home' %}">Crafty</a>
          <a href="{% url 'product_list' %}?category=all">Categories</a>
          <a href="{% url 'product_list' %}?featured=true">Featured</a>
          {% comment %} <a href="{% url 'artisan_list' %}">Artisans</a> {% endcomment %}
          <a href="#">Our Story</a>
        </div>

        <div class="nav-right">
          <button id="theme-toggle" class="theme-toggle">ðŸŒ™</button>

          <a href="{% url 'cart' %}" class="cart-link", id='cart-link'>
            ðŸ›’ Cart <span id="cart-count">0</span>
          </a>

          {% if user.is_authenticated %}
            {% if user.user_type == 'seller' %}
              <a href="{% url 'seller_dashboard' %}">Seller Dashboard</a>
            {% endif %}
            <a href="{% url 'profile' %}">Profile</a>
            <form method="post" action="{% url 'logout' %}" style="display:inline">
              {% csrf_token %}
              <button class="btn btn-outline" type="submit"
              onmouseover="this.style.backgroundColor='var(--color-error)'; this.style.borderColor='var(--color-error)'; this.style.color='var(--color-background)';"
              onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='var(--color-text)'; this.style.color='var(--color-text)';">
              Logout</button>
            </form>
          {% else %}
            <a href="{% url 'login' %}">Login</a>
            <a href="{% url 'signup' %}" class="btn btn-primary">Sign up</a>
          {% endif %}
        </div>
      </nav>
    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          <li class="message {{ message.tags }}">{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}

  </header>

  <main class="content">
    {% block content %}{% endblock %}
  </main>

  <footer class="site-footer">
    <div class="footer-grid container">
      <div class="footer-section">
        <h3>Crafty</h3>
        <p>Authentic handmade products from Indian artisans. Fair, sustainable and premium.</p>
      </div>
      <div class="footer-section">
        <h3>Categories</h3>
        <a href="{% url 'product_list' %}?category=home_decor">Home Decor</a>
        <a href="{% url 'product_list' %}?category=jewelry">Jewelry</a>
        <a href="{% url 'product_list' %}?category=clothing">Clothing</a>
        <a href="{% url 'product_list' %}?category=ceramics">Ceramics</a>
      </div>
      <div class="footer-section">
        <h3>Support</h3>
        <a href="{% url 'help_center' %}">Help Center</a>
        <a href="{% url 'shipping' %}">Shipping</a>
        <a href="{% url 'home' %}">Returns</a>
        <a href="{% url 'home' %}">Contact</a>
        <a href="{% url 'about' %}">About</a>
      </div>
      <div class="footer-section">
        <h3>Follow</h3>
        <a href="https://instagram.com" target="_blank">Instagram</a>
        <a href="https://pinterest.com" target="_blank">Pinterest</a>
        <a href="https://twitter.com" target="_blank">Twitter</a>
        <a href="https://facebook.com" target="_blank">Facebook</a>
      </div>
    </div>
    <div class="footer-copy">
      <small>Â© 2025 Crafty. All rights reserved.</small>
    </div>
  </footer>

<div id="drawer-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" aria-hidden="true"></div>
  
  <div id="cart-drawer" class="fixed top-0 right-0 w-80 h-full bg-white dark:bg-surface shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
    <div class="p-4 flex justify-between items-center border-b border-gray-200 dark:border-gray-700">
      <h2 class="text-xl font-semibold">Your Cart</h2>
      <button id="cart-close" class="text-2xl hover:text-error">&times;</button>
    </div>
    <div id="cart-drawer-body" class="p-4 overflow-y-auto h-full">
      <p class="text-center text-muted">Loading cart...</p>
    </div>
  </div>
  <footer class="site-footer">
    </footer>

</body>
</html>


<script>
  // Helper: get cookie value (CSRF)
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }

  // update cart-count DOM
  function setCartCount(n) {
    const el = document.getElementById('cart-count');
    if (!el) return;
    el.textContent = n;
    // small visual pulse
    el.style.transform = 'scale(1.1)';
    setTimeout(()=> el.style.transform = 'scale(1)', 150);
  }

  // fetch initial cart count on load
  document.addEventListener('DOMContentLoaded', async function () {
    try {
      const resp = await fetch(CraftyConfig.cartCountUrl);
      if (resp.ok) {
        const j = await resp.json();
        setCartCount(j.count || 0);
      }
    } catch (e) {
      // ignore silently
      console.error('cart count load error', e);
    }
  });

  // expose global function so add-to-cart script can call it
  window.setCartCount = setCartCount;
</script>

</body>
</html>
